<!DOCTYPE html>
<html lang="en">
    <%-include('../layouts/header')-%>
    <body>
        <!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WPZ6BNP4"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
        <!-- Navigation-->
        <%-include('../layouts/navbar')-%>
        
        <!-- Page Header-->
        <header class="masthead" style="background-image: url('/img/soufiane-bg.jpg')">
            <div class="container position-relative px-4 px-lg-5">
                <div class="row gx-4 gx-lg-5 justify-content-center">
                    <div class="col-md-10 col-lg-8 col-xl-7">
                        <div class="page-heading">
                           <h1>Manage Users</h1>
                           <span class="subheading">View and manage all registered users</span>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        
        <!-- Main Content-->
        <main class="mb-4">
            <div class="container px-4 px-lg-5">
                <div class="row gx-4 gx-lg-5 justify-content-center">
                    <div class="col-md-12 col-lg-10 col-xl-9">
                        <!-- Success/Error Messages -->
                        <% if (typeof success !== 'undefined' && success) { %>
                            <div class="alert alert-success" role="alert">
                                <%= success %>
                            </div>
                        <% } %>
                        <% if (typeof error !== 'undefined' && error) { %>
                            <div class="alert alert-danger" role="alert">
                                <%= error %>
                            </div>
                        <% } %>
                        
                        <!-- Actions Bar -->
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <a href="/admin/dashboard" class="btn btn-outline-secondary">‚Üê Back to Dashboard</a>
                        </div>
                        
                        <!-- Users Table -->
                        <div class="card">
                            <div class="card-header">
                                <h3>All Users (<%= users.length %>)</h3>
                            </div>
                            <div class="card-body">
                                <% if (users.length > 0) { %>
                                    <div class="table-responsive">
                                        <table class="table table-striped">
                                            <thead>
                                                <tr>
                                                    <th>Username</th>
                                                    <th>Email</th>
                                                    <th>Role</th>
                                                    <th>Status</th>
                                                    <th>Registered</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <% users.forEach(user => { %>
                                                <tr class="<%= !user.isActive ? 'table-secondary' : '' %>">
                                                    <td>
                                                        <strong><%= user.username %></strong>
                                                        <% if (user.role === 'admin') { %>
                                                            <span class="badge bg-warning text-dark ms-1">Admin</span>
                                                        <% } %>
                                                    </td>
                                                    <td><%= user.email %></td>
                                                    <td>
                                                        <span class="badge <%= user.role === 'admin' ? 'bg-warning text-dark' : 'bg-secondary' %>">
                                                            <%= user.role.charAt(0).toUpperCase() + user.role.slice(1) %>
                                                        </span>
                                                    </td>
                                                    <td>
                                                        <% if (user.isActive !== false) { %>
                                                            <span class="badge bg-success">Active</span>
                                                        <% } else { %>
                                                            <span class="badge bg-danger">Inactive</span>
                                                        <% } %>
                                                    </td>
                                                    <td><%= new Date(user.createdAt).toLocaleDateString() %></td>
                                                    <td>
                                                        <div class="btn-group" role="group">
                                                            <button class="btn btn-sm btn-outline-secondary" disabled>
                                                                View Profile
                                                            </button>
                                                            <!-- Future: Add user management actions here -->
                                                        </div>
                                                    </td>
                                                </tr>
                                                <% }); %>
                                            </tbody>
                                        </table>
                                    </div>
                                <% } else { %>
                                    <div class="text-center py-4">
                                        <p class="text-muted">No users found.</p>
                                    </div>
                                <% } %>
                            </div>
                        </div>
                        
                        <!-- User Statistics -->
                        <div class="row mt-4">
                            <div class="col-md-4">
                                <div class="card text-center">
                                    <div class="card-body">
                                        <h3 class="card-title text-primary">
                                            <%= users.filter(u => u.role === 'admin').length %>
                                        </h3>
                                        <p class="card-text">Administrators</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card text-center">
                                    <div class="card-body">
                                        <h3 class="card-title text-success">
                                            <%= users.filter(u => u.role === 'user').length %>
                                        </h3>
                                        <p class="card-text">Regular Users</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card text-center">
                                    <div class="card-body">
                                        <h3 class="card-title text-info">
                                            <%= users.filter(u => u.isActive !== false).length %>
                                        </h3>
                                        <p class="card-text">Active Users</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- Footer-->
        <%-include('../layouts/footer')-%>
    </body>
</html>