<!DOCTYPE html>
<html lang="en">
    <!-- Head -->
     <%-include('layouts/header')-%>
     <style>
        /* Live Preview Styles - Full Width */
        .editor-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            min-height: 500px;
            max-width: none;
            width: 100%;
        }
        
        .editor-pane {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            background: #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .preview-pane {
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 25px;
            background: #f8f9fa;
            overflow-y: auto;
            max-height: 600px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .preview-content {
            font-family: 'Lora', serif;
            line-height: 1.6;
            color: #212529;
        }
        
        .preview-title {
            font-size: 1.75rem;
            font-weight: bold;
            margin-bottom: 1rem;
            color: #0085A1;
        }
        
        .preview-label {
            font-weight: bold;
            color: #0085A1;
            margin-bottom: 15px;
            display: block;
            font-size: 1.1rem;
        }
        
        .form-control {
            font-size: 16px;
            line-height: 1.6;
        }
        
        #body {
            font-family: 'Lora', serif !important;
            font-size: 16px !important;
            line-height: 1.6 !important;
            color: #212529 !important;
        }
        
        @media (max-width: 768px) {
            .editor-container {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }
        
        /* Full width form styling */
        .full-width-form {
            width: 100%;
            max-width: none;
        }
     </style>
    <body>
        <!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WPZ6BNP4"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
        <!-- Navigation-->
        <%-include('layouts/navbar')-%>
        <!-- Page Header-->
        <header class="masthead" style="background-image: url('/img/create-bg.jpg')">
            <div class="container position-relative px-4 px-lg-5">
                <div class="row gx-4 gx-lg-5 justify-content-center">
                    <div class="col-md-10 col-lg-8 col-xl-7">
                        <div class="page-heading">
                            <h1>Create New Post</h1>
                            <span class="subheading">Have questions? I have answers.</span>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        <!-- Main Content-->
        <main class="mb-4">
            <div class="container-fluid px-3">
                <div class="row">
                    <div class="col-12">
                        <div class="text-center mb-4">
                            <h2>Create New Post</h2>
                            <p>Create a new blog post with live preview</p>
                        </div>
                        <!---form '/posts/strore' -->
                        <div class="my-5 full-width-form">
                            <form action="/posts/store" method="post" enctype="multipart/form-data">
                                <!-- Title Field -->
                                <div class="control-group mb-4">
                                    <div class="form-group floating-label-form-group controls">
                                        <label for="title">Title</label>
                                        <input type="text" class="form-control" placeholder="Blog Post Title" id="title" name="title" required>
                                    </div>
                                </div>

                                <!-- Editor Container with Live Preview -->
                                <div class="editor-container">
                                    <!-- Left Pane: Editor -->
                                    <div class="editor-pane">
                                        <label for="body" class="preview-label">üìù Content Editor</label>
                                        <textarea rows="22" class="form-control" id="body" name="body" 
 placeholder="Write your blog post content here..." 
 required style="resize: vertical; min-height: 450px; border: none; box-shadow: none;"></textarea>
                                    </div>

                                    <!-- Right Pane: Live Preview -->
                                    <div class="preview-pane">
                                        <h3 class="preview-label">üëÅÔ∏è Live Preview</h3>
                                        <div class="preview-content">
                                            <div id="preview-title" class="preview-title">Your Post Title</div>
                                            <div id="preview-body">Start typing to see your content preview...</div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Image Upload -->
                                <div class="control-group mt-4">
                                    <div class="form-group floating-label-form-group controls">
                                        <label for="image">Background Image</label>
                                        <input class="form-control" name="image" id="image" type="file">
                                    </div>
                                </div>
                                 
                                <br>
                                <div class="form-group text-center">
                                    <button type="submit" class="btn btn-primary btn-lg px-5" id="createPostButton">
                                        <i class="fas fa-plus me-2"></i>Create Post
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
                    </div>
                </div>
            </div>
        </main>
        <!-- Footer-->
        <%-include('layouts/footer')-%>
        
        <!-- Live Preview JavaScript -->
        <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Get DOM elements
            const titleInput = document.getElementById('title');
            const bodyTextarea = document.getElementById('body');
            const previewTitle = document.getElementById('preview-title');
            const previewBody = document.getElementById('preview-body');
            
            // Debounce function - prevents too many updates while typing
            function debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            }
            
            // Function to convert simple markdown-like syntax to HTML
            function simpleMarkdown(text) {
                return text
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')  // **bold**
                    .replace(/\*(.*?)\*/g, '<em>$1</em>')              // *italic*
                    .replace(/\n\n/g, '</p><p>')                       // paragraphs
                    .replace(/\n/g, '<br>');                           // line breaks
            }
            
            // Function to update the preview
            function updatePreview() {
                // Update title preview
                const titleValue = titleInput.value.trim();
                previewTitle.textContent = titleValue || 'Your Post Title';
                
                // Update body preview with markdown-like formatting
                const bodyValue = bodyTextarea.value.trim();
                if (bodyValue) {
                    // Wrap in paragraph tags and apply simple markdown
                    const formattedContent = '<p>' + simpleMarkdown(bodyValue) + '</p>';
                    previewBody.innerHTML = formattedContent;
                    
                    // Re-render MathJax in the preview area
                    if (window.MathJax && window.MathJax.typesetPromise) {
                        MathJax.typesetPromise([previewBody]).catch(function (err) {
                            console.log('MathJax rendering error:', err.message);
                        });
                    }
                } else {
                    previewBody.innerHTML = '<em>Start typing to see your content preview...</em>';
                }
            }
            
            // Create debounced version of updatePreview (300ms delay)
            const debouncedUpdate = debounce(updatePreview, 300);
            
            // Add event listeners for real-time updates
            titleInput.addEventListener('input', debouncedUpdate);
            bodyTextarea.addEventListener('input', debouncedUpdate);
            
            // Initial preview update
            updatePreview();
            
            console.log('Live preview initialized!');
        });
        </script>
        
        <!-- Bootstrap core JS-->
        
    </body>
</html>
